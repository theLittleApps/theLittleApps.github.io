<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
  <title>
    
    Apple çš„å°å¿ƒæ€ï¼šModern Cell Configuration ä¸¨
    

    thelittleapps
  </title>

  
  <link rel="shortcut icon" href="/logo.svg">
  

  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  
  <link id="theme" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-light.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
  

  <!-- å­—ä½“ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">

  
<link rel="stylesheet" href="/css/root.css">

  
<link rel="stylesheet" href="/css/style.css">

  
<link rel="stylesheet" href="/css/post.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <header class="header">
  <section class="header-container">
    <a class="logo" href="/">The Little Apps</a>
    <ul class="nav">
      
      <li><a href="/archives">blogs</a></li>
      
      <li><a href="/about">about</a></li>
      
    </ul>
  </section>
</header>
  <main class="main">
    <article class="post">
  
  <div class="post-title">Apple çš„å°å¿ƒæ€ï¼šModern Cell Configuration</div>
  <div class="post-meta">
    <div class="date">2024 September 25th</div>
    <div class="tags">
      
    </div>
  </div>
  

  <main class="post-content"><p>å¤§å”å‰›å…¥è¡Œæ™‚ï¼Œé‚„æ˜¯ iPhone 4s çš„æ™‚ä»£ï¼Œé‚£æ™‚å¾Œæ‰‹æ©Ÿä¸Šçš„ç¡¬é«”è³‡æºæœ‰é™ï¼Œè¨˜æ†¶é«”é‚„å¾ˆçè²´ï¼Œæœ‰é€™éº¼å¤š APP è¦ä¸€èµ·å…±äº«ï¼Œæ‰€ä»¥åœ¨å¯« APP çš„æ™‚å€™ï¼Œè¨˜æ†¶é«”çš„ä½¿ç”¨å°±éœ€è¦ç‰¹åˆ¥çš„æ³¨æ„ï¼Œä¸ç®¡æ˜¯è¦ <strong>alloc</strong> ( è¨˜æ†¶é«”é…ç½® ) è®Šæ•¸æˆ–æ˜¯ <strong>free</strong> ( è¨˜æ†¶é«”é‡‹æ”¾ ) éƒ½è¦å°å¿ƒï¼Œä¸€ä¸ç•™æ„ APP å°±æœƒè·Ÿå¤§å”é–ƒé€€ say goodbyeã€‚ç¶“å…¸çš„<strong>UIKit</strong> æ¡†æ¶å°±èª•ç”Ÿåœ¨é€™æ¨£çš„èƒŒæ™¯ä¸­ï¼Œåœ¨ <strong>UIKit</strong> ä¸­ä¸»åŠ›æ˜¯ä½¿ç”¨ <strong>class</strong> ( é¡åˆ¥ ) çš„å‹åˆ¥ï¼Œå®ƒæ˜¯ä¸€ç¨® <strong>reference type</strong> ï¼Œè€Œä¾†åˆ°äº† iPhone 16 ( iOS 18 ) çš„æ™‚ä»£ï¼Œæœ‰äº† <strong>AI</strong> çš„å‰›éœ€ï¼ŒiPhone è¨˜æ†¶é«” ( RAM ) ä¾†åˆ°äº†å‚³èä¸­çš„ <strong>8G</strong>ï¼Œç¾åœ¨çš„ <strong>SwiftUI</strong>ï¼Œå°±ç”± <strong>class</strong> æ”¹è®Šæˆ <strong>struct</strong> ( çµæ§‹ )ï¼Œstruct æ˜¯ä¸€ç¨® <strong>value type</strong> çš„å‹åˆ¥ã€‚é‚£è˜‹æœç‚ºä½•å¾ <strong>class</strong> è½‰æ€§æˆ <strong>struct</strong>ï¼Ÿå¾<strong>æŒ‡æ¨™</strong>æŒ‡ä¾†æŒ‡å»çš„ <strong>refernce type</strong> è½‰æˆï¼Œæ¯æ¬¡ä½¿éƒ½è¦ <strong>clone</strong> æˆ– <strong>create</strong> çš„ <strong>value type</strong> ï¼Ÿå…¨æ˜¯ç‚ºäº†å…©å€‹å­—ï¼š<strong>å®‰å…¨</strong>ã€‚è‡³æ–¼ <strong>struct</strong> æ€éº¼ä¾†å€‹å®‰å…¨æ³•ï¼Œé€™åˆæ˜¯å¦ä¸€ç¯‡æ•…äº‹äº†ğŸ˜</p>
<p><img src="https://thelittleappsblogsbucket.s3.ap-northeast-1.amazonaws.com/moderncellconfiguration/01_class_struct.webp" alt="01_class_struct"></p>
<h1 id="Classic-Cell-Configuration"><a href="#Classic-Cell-Configuration" class="headerlink" title="Classic Cell Configuration"></a>Classic Cell Configuration</h1><p>å¯¦å‹™ä¸Š APP å¸¸ä½¿ç”¨åˆ°åˆ—è¡¨é  (<strong>UITableView</strong>) çš„ UIï¼Œå¦‚æœè¦ç”¨ <strong>UIKit</strong> ä¾†ç´”å¯« code ä¾†å¯¦ä½œçš„è©±ï¼Œé€šå¸¸æœƒå…ˆåœ¨ <strong>UIViewController</strong> ä¸Š create <strong>UITableView</strong>ï¼Œåœ¨é€™ table view ä¸Šè¨»å†Šæˆ‘å€‘å¯« code å®¢è£½åŒ–è‡ªè¨‚çš„ <strong>cell</strong> ( <strong>ç¹¼æ‰¿ UITableViewCell</strong> ) å¦‚</p>
<pre><code class="highlight php"><span class="comment">// register cells</span>
tableView.<span class="title function_ invoke__">register</span>(NewsCell.<span class="built_in">self</span>, <span class="attr">forCellReuseIdentifier</span>: NewsCell.identifier)</code></pre>


<p>ç„¶å¾Œåœ¨ table view çš„ <strong>data source</strong> ä¸­ï¼Œcreate cell ï¼Œä¸¦è¨­å®šé‡è¤‡ä½¿ç”¨é€™ cell ï¼Œç„¶å¾ŒæŠŠè³‡æ–™ ( model ) å‚³å…¥ cell å¾Œï¼Œå›å‚³ã€‚</p>
<pre><code class="highlight swift"><span class="keyword">func</span> <span class="title function_">tableView</span>(<span class="keyword">_</span> <span class="params">tableView</span>: <span class="type">UITableView</span>, <span class="params">cellForRowAt</span> <span class="params">indexPath</span>: <span class="type">IndexPath</span>) -&gt; <span class="type">UITableViewCell</span> &#123;
    <span class="comment">// classic cell for custom cell in programming</span>
    <span class="keyword">let</span> cell <span class="operator">=</span> tableView.dequeueReusableCell(withIdentifier: <span class="type">NewsCell</span>.identifier, for: indexPath) <span class="keyword">as!</span> <span class="type">NewsCell</span>
    <span class="keyword">let</span> a_news <span class="operator">=</span> news[indexPath.row]
    cell.set(news: a_news)
        
    <span class="keyword">return</span> cell    
&#125;</code></pre>


<p>è€Œæˆ‘å€‘é€™å®¢è£½åŒ–çš„ cellï¼Œdata type ç‚º <strong>class</strong> ï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç¹¼æ‰¿ <strong>UITableViewCell</strong> é€™è˜‹æœå…ˆå¹«æˆ‘å€‘å¯«å¥½çš„ cellã€‚</p>
<pre><code class="highlight swift"><span class="keyword">import</span> UIKit

<span class="keyword">class</span> <span class="title class_">NewsCell</span>: <span class="title class_ inherited__">UITableViewCell</span> &#123;

    <span class="keyword">static</span> <span class="keyword">let</span> identifier <span class="operator">=</span> <span class="string">&quot;NewsCell&quot;</span>

    <span class="keyword">var</span> newsImageView <span class="operator">=</span> <span class="type">UIImageView</span>()
    <span class="keyword">var</span> newsTitleLabel <span class="operator">=</span> <span class="type">UILabel</span>()
    <span class="keyword">var</span> newsSourceLabel <span class="operator">=</span> <span class="type">UILabel</span>()
    
    <span class="keyword">override</span> <span class="keyword">init</span>(<span class="params">style</span>: <span class="type">UITableViewCell</span>.<span class="type">CellStyle</span>, <span class="params">reuseIdentifier</span>: <span class="type">String</span>?) &#123;
        <span class="keyword">super</span>.<span class="keyword">init</span>(style: style, reuseIdentifier: reuseIdentifier)
        layoutViews()
    &#125;
    
    <span class="keyword">required</span> <span class="keyword">init?</span>(<span class="params">coder</span>: <span class="type">NSCoder</span>) &#123;
        <span class="built_in">fatalError</span>(<span class="string">&quot;init(coder:) has not been implemented&quot;</span>)
    &#125;
    
    <span class="keyword">func</span> <span class="title function_">set</span>(<span class="params">news</span>: <span class="type">News</span>) &#123;
        newsImageView.image <span class="operator">=</span> news.image
        newsTitleLabel.text <span class="operator">=</span> news.title
        newsSourceLabel.text <span class="operator">=</span> news.source
    &#125;
	
	<span class="operator">...</span>
&#125;</code></pre>


<p>å®Œæ•´ç¨‹å¼ï¼š<a target="_blank" rel="noopener" href="https://github.com/theLittleApps/ModernCellConfigurationExample/blob/main/ModernCellConfigurationExe/ClassicCellConfig/NewsCell.swift">ModernCellConfigurationExe&#x2F;ClassicCellConfig&#x2F;NewsCell.swift</a></p>
<p>ç”±ä»¥ä¸Šçš„ç¯„ä¾‹ï¼Œçœ‹åˆ°å‚³å…¥ cell çš„è³‡æ–™ï¼Œç›´æ¥è¨­å®šåœ¨ cell çš„ UI å…ƒä»¶ ( <strong>UIImageView &amp; UILabel</strong> ) ä¸Šï¼Œé€™å¥—ç¶“å…¸çš„å¯«æ³•å¤§å”æŠŠå®ƒç¨±ä½œã€Œ<strong>Classic Cell Configuration</strong> ã€ï¼Œåå¤šå¹´ä¾†é€™ <strong>Table View Cell</strong> çš„ç¶“å…¸è¨­è¨ˆæ¬¾ï¼Œè˜‹æœå¤§æ¦‚æ˜¯å¾ˆé›£å°‡å®ƒä¸‹æ¶å§ï¼ä½†æ™‚ä»£åœ¨è®Š å¯« APP çš„æ–¹æ³•ä¹Ÿåœ¨è®Šï¼Œåœ¨ <a target="_blank" rel="noopener" href="https://www.apple.com/tw/newsroom/2020/06/wwdc20-highlights/">WWDC 2020</a> æ™‚ï¼Œæˆ‘å€‘è˜‹æœæ•™ä¸»æå‡ºäº†ä¸€å¥—ã€Œ<strong>Modern Cell Configuration</strong>ã€çš„æ–°è¨­è¨ˆï¼Œä½œç‚º <strong>Table View Cell</strong> çš„æ–°æ™‚ä»£ä¹‹ä½œï¼Œæƒ³å¿…è˜‹æœåœ–çš„å¿ƒæ€æ˜¯æƒ³è®“ <strong>UIKit</strong> ç¹¼çºŒå­˜æ´»å€‹å¥½å¹¾å¹´å§ï¼Œä½†æ•™ä¸»å¿ƒæ€è±ˆæ­¢æ–¼æ­¤ï¼Œå¾…å¤§å”å¨“å¨“é“ä¾†ğŸ˜</p>
<p><a target="_blank" rel="noopener" href="https://developer.apple.com/wwdc20/10027">Modern cell configuration - WWDC20 - Videos - Apple Developer</a></p>
<h1 id="Modern-Cell-Configuration"><a href="#Modern-Cell-Configuration" class="headerlink" title="Modern Cell Configuration"></a>Modern Cell Configuration</h1><h2 id="STEP1"><a href="#STEP1" class="headerlink" title="STEP1"></a>STEP1</h2><p>å…ˆ create å¦ä¸€å€‹æ–°çš„ cell å¦‚</p>
<pre><code class="highlight perl">import UIKit

<span class="class"><span class="keyword">class</span> <span class="title">NewsCell_MCC</span>: <span class="title">UITableViewCell</span> </span>&#123;
    static let identifier = <span class="string">&quot;NewsCell_MCC&quot;</span>
&#125;</code></pre>




<h2 id="STEP2"><a href="#STEP2" class="headerlink" title="STEP2"></a>STEP2</h2><p>ä¸‹ä¸€æ­¥ create ä¸€æ–°çš„ <strong>struct</strong>ï¼Œå¦‚å–åç‚º NewsContentConfigurationï¼Œå…¶ä¸­é€™ <strong>struct</strong> éœ€éµå¾  <code>UIContentConfiguration</code> é€™ <strong>protocol</strong> ( å”å®š )ï¼Œ<strong>Swift</strong> è¦å®š <strong>struct</strong> ç„¡æ³•ç¹¼æ‰¿åªèƒ½éµå¾å”å®š ( <strong>protocol</strong> ) å¦‚</p>
<p><img src="https://thelittleappsblogsbucket.s3.ap-northeast-1.amazonaws.com/moderncellconfiguration/03_content_configuration.webp" alt="03_content_configuration"></p>
<p><strong>UIContentConfiguration</strong> å”å®šï¼Œå¿…éœ€è¦å¯¦ä½œå…©å€‹ <strong>Instance Methods</strong></p>
<pre><code class="highlight swift"><span class="keyword">import</span> UIKit

<span class="keyword">struct</span> <span class="title class_">NewsContentConfiguration</span>: <span class="title class_ inherited__">UIContentConfiguration</span> &#123;
    <span class="keyword">func</span> <span class="title function_">makeContentView</span>() -&gt; <span class="keyword">any</span> <span class="type">UIView</span> &amp; <span class="type">UIContentView</span> &#123;
    &#125;
    
    <span class="comment">// update different style based on cell&#x27;s state</span>
    <span class="keyword">func</span> <span class="title function_">updated</span>(<span class="params">for</span> <span class="params">state</span>: <span class="keyword">any</span> <span class="type">UIConfigurationState</span>) -&gt; <span class="type">NewsContentConfiguration</span> &#123;
    &#125;
&#125;</code></pre>

<h3 id="makeConentView"><a href="#makeConentView" class="headerlink" title="makeConentView()"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uicontentconfiguration/3600982-makecontentview">makeConentView()</a></h3><p>å¯ä»¥ç”¢ç”Ÿ table view cell çš„ç•«é¢ ( <strong>content view</strong> )ï¼Œç”¨åœ¨ <strong>Content Configuration</strong> ä¸­</p>
<h3 id="updated-for"><a href="#updated-for" class="headerlink" title="updated(for:)"></a><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uicontentconfiguration/3600983-updated">updated(for:)</a></h3><p> åœ¨é€™ method ä¸­å¯ä»¥å…ˆé è¨­å¥½ <strong>cell çš„å„å€‹ç‹€æ…‹ ( state )</strong> è¦é¡¯ç¤ºçš„ UI æˆ–è³‡æ–™ ï¼Œä¹‹å¾Œå†ä¾å‚³å…¥<strong>ç‹€æ…‹</strong> (<strong>UIConfigurationState</strong>)ï¼Œå›å‚³ <strong>Content Configuration</strong> </p>
<h2 id="STEP3"><a href="#STEP3" class="headerlink" title="STEP3"></a>STEP3</h2><p>å†ä¾†ç”¢ç”Ÿä¸€ <strong>ContentView</strong>ï¼Œå³<strong>NewsContentConfiguration</strong> ä¸­ <strong>makeContentView()</strong> éœ€å›å‚³çš„ã€‚å¦‚</p>
<p><img src="https://thelittleappsblogsbucket.s3.ap-northeast-1.amazonaws.com/moderncellconfiguration/04_content_view.webp" alt="04_content_view"></p>
<p>é€™ <strong>NewsContentView</strong> ç‚º <strong>class</strong>ï¼Œé™¤äº†ç¹¼æ‰¿ äº† <strong>UIView</strong> å¤– ï¼Œé‚„éœ€è¦éµå¾ <strong><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uicontentview">UIContentView</a></strong> å”å®š</p>
<p><img src="https://thelittleappsblogsbucket.s3.ap-northeast-1.amazonaws.com/moderncellconfiguration/05_uicontentview.webp" alt="05_uicontentview"></p>
<p><strong>UIContentView</strong>ï¼Œéœ€è¦å®£å‘Šåƒæ•¸ <code>var configuration: any UIContentConfiguration</code>ï¼Œç›®çš„æ˜¯ç”¨ä¾†å‚³å…¥ <strong>STEP2</strong> ä¸­çš„ <strong>configuration</strong></p>
<pre><code class="highlight swift"><span class="keyword">import</span> UIKit

<span class="keyword">class</span> <span class="title class_">NewsContentView</span>: <span class="title class_ inherited__">UIView</span>, <span class="title class_ inherited__">UIContentView</span> &#123;
    <span class="keyword">var</span> configuration: <span class="keyword">any</span> <span class="type">UIContentConfiguration</span>
    
    <span class="keyword">init</span>(<span class="params">configuration</span>: <span class="keyword">any</span> <span class="type">UIContentConfiguration</span>) &#123;
        <span class="keyword">self</span>.configuration <span class="operator">=</span> configuration
        <span class="keyword">super</span>.<span class="keyword">init</span>(frame: .zero)
    &#125;
    
    <span class="keyword">required</span> <span class="keyword">init?</span>(<span class="params">coder</span>: <span class="type">NSCoder</span>) &#123;
        <span class="built_in">fatalError</span>(<span class="string">&quot;init(coder:) has not been implemented&quot;</span>)
    &#125;
&#125;</code></pre>





<h2 id="STEP4"><a href="#STEP4" class="headerlink" title="STEP4"></a>STEP4</h2><p>åƒè€ƒç¯„ä¾‹ç¨‹å¼æŠŠ <strong><a target="_blank" rel="noopener" href="https://github.com/theLittleApps/ModernCellConfigurationExample/blob/main/ModernCellConfigurationExe/ModernCellConfig/NewsContentConfiguration.swift">NewsContentConfiguration</a></strong> èˆ‡ <strong><a target="_blank" rel="noopener" href="https://github.com/theLittleApps/ModernCellConfigurationExample/blob/main/ModernCellConfigurationExe/ModernCellConfig/NewsContentView.swift">NewsContentView</a></strong> å‰©ä¸‹çš„éƒ¨åˆ†è£œä¸Š</p>
<h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><h3 id="NewsContentConfiguration"><a href="#NewsContentConfiguration" class="headerlink" title="NewsContentConfiguration"></a>NewsContentConfiguration</h3><pre><code class="highlight swift"><span class="keyword">struct</span> <span class="title class_">NewsContentConfiguration</span>: <span class="title class_ inherited__">UIContentConfiguration</span> &#123;
    <span class="comment">// data</span>
    <span class="keyword">let</span> news: <span class="type">News</span>
    
    <span class="keyword">func</span> <span class="title function_">makeContentView</span>() -&gt; <span class="keyword">any</span> <span class="type">UIView</span> &amp; <span class="type">UIContentView</span> &#123;
        <span class="keyword">return</span> <span class="type">NewsContentView</span>(configuration: <span class="keyword">self</span>)
    &#125;
    
    <span class="comment">// update different style based on cell&#x27;s state</span>
    <span class="keyword">func</span> <span class="title function_">updated</span>(<span class="params">for</span> <span class="params">state</span>: <span class="keyword">any</span> <span class="type">UIConfigurationState</span>) -&gt; <span class="type">NewsContentConfiguration</span> &#123;
        <span class="keyword">return</span> <span class="keyword">self</span>
    &#125;
&#125;</code></pre>

<p>å¦‚ä¸Šï¼Œå…ˆå®£å‘Šè¦é¡¯ç¤ºçš„è³‡æ–™ ( <strong>News Model</strong> ) ï¼Œè€Œ <strong>makeContentView</strong> ä¸­å‰‡å›å‚³ <strong>SETP3</strong> ä¸­çš„ <strong>content view</strong> ï¼Œä¸¦åŒæ™‚ä¹ŸæŠŠè‡ªå·± <strong>self</strong> ( <strong>NewsContentConfiguration</strong> )ï¼Œå‚³å…¥ <strong>content view</strong> è£¡ï¼Œè‡³æ–¼ <strong>update(for:)</strong> æš«æ™‚å…ˆå›å‚³è‡ªå·± ( <strong>self</strong> )ã€‚</p>
<h3 id="NewsContentView"><a href="#NewsContentView" class="headerlink" title="NewsContentView"></a>NewsContentView</h3><p>åœ¨ <strong>Classic Cell Configuration</strong> ä¸­ï¼Œæˆ‘å€‘æœƒç›´æ¥åœ¨ <strong>table view cell</strong> ä¸­è¨­å®š UI ( <strong>UIImageView &amp; UILabel</strong> ) çš„ <strong>layout</strong> å’Œå…¶å€¼ï¼Œå¦‚</p>
<pre><code class="highlight stylus">func <span class="built_in">set</span>(news: News) &#123;
    newsImageView<span class="selector-class">.image</span> = news<span class="selector-class">.image</span>
    newsTitleLabel<span class="selector-class">.text</span> = news<span class="selector-class">.title</span>
    newsSourceLabel<span class="selector-class">.text</span> = news<span class="selector-class">.source</span>
&#125;</code></pre>

<p>ä½†åœ¨ <strong>Modern Cell Configuration</strong> ä¸­ï¼Œæˆ‘å€‘å¯ä»¥æŠŠåŸæœ¬ cell ä¸­çš„è¨­å®šï¼Œç›¡æ•¸æ¬åˆ° <strong>content view</strong> ä¸­ï¼Œå¦‚</p>
<pre><code class="highlight scss">private func <span class="built_in">layoutViews</span>() &#123;
    <span class="built_in">addSubviews</span>()
    <span class="built_in">configureSubViews</span>()
    <span class="built_in">setConstraints</span>()    
&#125;</code></pre>

<p>è€Œè¨­å®š UI è³‡æ–™ï¼Œå‰‡éœ€é€é <strong>content configuration</strong> åƒæ•¸å‚³å…¥ï¼Œå¦‚</p>
<pre><code class="highlight arduino"><span class="function"><span class="keyword">private</span> func <span class="title">setNews</span><span class="params">()</span> </span>&#123;
    guard let config = configuration as? NewsContentConfiguration <span class="keyword">else</span> &#123;
        <span class="keyword">return</span>
    &#125;

    newsImageView.image = config.news.image
    newsTitleLabel.text = config.news.title
    newsSourceLabel.text = config.news.source   
&#125;</code></pre>

<p>é€™å‚³å…¥çš„ <strong>content configuration</strong> æ˜¯ä¸æ˜¯å¾ˆåƒ <strong>MVVM</strong> é–‹ç™¼ä¸­çš„ <strong>View Model</strong>ï¼Œé€™å€‹ <strong>configuration</strong> æ˜¯ <strong>struct</strong>ï¼Œå° iOS ä¾†èªªæ˜¯ <strong>struct</strong> éå¸¸è¼•é‡ï¼Œæ®ºæ‰å¾Œå†æ¬¡ç”¢ç”Ÿï¼Œä¹Ÿä¸æœƒæœ‰ä»€éº¼è² æ“”ï¼Œ <strong>struct</strong> æ˜¯è˜‹æœçš„æ–°æ­¡ï¼Œä½¿ç”¨ <strong>configuration</strong> å¯ä»¥æŠŠ <strong>UI</strong> èˆ‡ <strong>data</strong> å€åˆ†é–‹ä¾†ï¼ŒåŒæ¨£çš„ <strong>configuration</strong> å°±å¯ä½¿ç”¨åœ¨ä¸åŒçš„ <strong>content view</strong> ä¸Šã€‚</p>
<h3 id="NewsCell-MCC"><a href="#NewsCell-MCC" class="headerlink" title="NewsCell_MCC"></a>NewsCell_MCC</h3><p>ç¶“é <strong>Modern Cell Configuration</strong> çš„å·§æ‰‹å”åŠ©ï¼Œ <strong>table view cell</strong> å¯ä»¥ç°¡åŒ–æˆï¼š</p>
<pre><code class="highlight swift"><span class="keyword">import</span> UIKit

<span class="keyword">class</span> <span class="title class_">NewsCell_MCC</span>: <span class="title class_ inherited__">UITableViewCell</span> &#123;
    <span class="keyword">static</span> <span class="keyword">let</span> identifier <span class="operator">=</span> <span class="string">&quot;NewsCell_MCC&quot;</span>

    <span class="keyword">func</span> <span class="title function_">set</span>(<span class="params">news</span>: <span class="type">News</span>) &#123;
        contentConfiguration <span class="operator">=</span> <span class="type">NewsContentConfiguration</span>(news: news)
    &#125;
&#125;</code></pre>

<p>æ¯æ¬¡å‘¼å« cell çš„ <strong>set(news:)</strong> æ™‚ï¼Œå¯ä»¥ç”¢ç”Ÿæ–°çš„ <strong>NewsContentConfiguration</strong>ï¼Œä¸¦æŠŠå®ƒè¨­å®šç‚º <strong>cell</strong> çš„ <strong>contentConfiguration</strong> ï¼Œå®ƒæ˜¯ <strong>iOS 14</strong> ä¹‹å¾Œè˜‹æœç‚º <strong>table view cell</strong> æ–°åŠ å…¥çš„å±¬æ€§ï¼Œå®ƒçš„è³‡æ–™å‹æ…‹å°±æ˜¯ <strong>UIContentConfiguration</strong></p>
<pre><code class="highlight less"><span class="variable">@available</span>(iOS <span class="number">14.0</span>, tvOS <span class="number">14.0</span>, *)
extension UITableViewCell &#123;
    
    <span class="variable">@available</span>(iOS <span class="number">14.0</span>, tvOS <span class="number">14.0</span>, *)
    <span class="variable">@MainActor</span> <span class="variable">@preconcurrency</span> public var <span class="attribute">contentConfiguration</span>: (any UIContentConfiguration)?

    <span class="variable">@available</span>(iOS <span class="number">14.0</span>, tvOS <span class="number">14.0</span>, *)
    <span class="variable">@MainActor</span> <span class="variable">@preconcurrency</span> public func <span class="built_in">defaultContentConfiguration</span>() -&gt; UIListContentConfiguration
&#125;</code></pre>

<p>é€™æ™‚å€™å¯ä»¥åŸ·è¡Œç¨‹å¼äº†ï¼Œè·‘èµ·ä¾†çµæœæ‡‰è©²å’Œ <strong>classic cell configuration</strong> ç›¸åŒã€‚</p>
<h1 id="Update-Configuration-State"><a href="#Update-Configuration-State" class="headerlink" title="Update Configuration State"></a>Update Configuration State</h1><p>åŸæœ¬ç”¨å‚³çµ±çš„ <strong>classic cell configuration</strong> çš„æ–¹å¼ï¼Œè¦é”æˆæ‰‹æŒ‡é¸åˆ°å“ªå€‹ cell ï¼Œé€™ cell å°±è¦èƒ½è®Šæ›é¡è‰²ï¼Œå¯èƒ½éœ€è¦å»å®£å‘Š <strong>table view delegate</strong> çš„æ–¹æ³•ï¼Œå»æ””æˆªæ¥æ”¶æ‰‹æŒ‡ touch åˆ° cell çš„ event ä¾†è®Šæ›é¡è‰²ï¼Œæ•´å€‹æ„Ÿè¦ºç›¸ç•¶çš„éº»ç…©èˆ‡å›‰å”†ã€‚</p>
<p>ä½†å¦‚æœç”¨ <strong>modern cell configuration</strong> ä¾†å¯¦ä½œçš„è©±ï¼Œå¯èƒ½æœƒè®Šå¾—ç°¡å–®ä¸€é»ã€‚ç¥å¥‡çš„åœ°æ–¹å°±ç™¼ç”Ÿåœ¨ <strong>configuration</strong> ä¸­çš„ <strong>update(for:)</strong> é€™ methodï¼Œä¿®æ”¹ <strong>content configuration</strong> å¦‚</p>
<pre><code class="highlight swift"><span class="keyword">struct</span> <span class="title class_">NewsContentConfiguration_US</span>: <span class="title class_ inherited__">UIContentConfiguration</span> &#123;
    <span class="comment">// data</span>
    <span class="keyword">let</span> news: <span class="type">News</span>
    <span class="comment">// ui style</span>
    <span class="keyword">var</span> textColor: <span class="type">UIColor</span>?
    
    <span class="keyword">func</span> <span class="title function_">makeContentView</span>() -&gt; <span class="keyword">any</span> <span class="type">UIView</span> &amp; <span class="type">UIContentView</span> &#123;
        <span class="keyword">return</span> <span class="type">NewsContentView_US</span>(configuration: <span class="keyword">self</span>)
    &#125;
    
    <span class="keyword">func</span> <span class="title function_">updated</span>(<span class="params">for</span> <span class="params">state</span>: <span class="keyword">any</span> <span class="type">UIConfigurationState</span>) -&gt; <span class="type">NewsContentConfiguration_US</span> &#123;
        <span class="keyword">guard</span> <span class="keyword">let</span> state <span class="operator">=</span> state <span class="keyword">as?</span> <span class="type">UICellConfigurationState</span> <span class="keyword">else</span> &#123;
            <span class="keyword">return</span> <span class="keyword">self</span>
        &#125;
        
        <span class="keyword">var</span> updatedConfig <span class="operator">=</span> <span class="keyword">self</span>
        <span class="comment">// when cell is selected, text color would turn to white</span>
        <span class="keyword">if</span> state.isSelected &#123;
            updatedConfig.textColor <span class="operator">=</span> .systemRed
        &#125;<span class="keyword">else</span> &#123;
            updatedConfig.textColor <span class="operator">=</span> .black
        &#125;
        
        <span class="keyword">return</span> updatedConfig
    &#125;
&#125;
</code></pre>



<p>åœ¨ <strong>updated(for:)</strong> ä¸­ä¾å‚³å…¥çš„ <strong>UIConfigurationState</strong> ä¾†è¨­å®š cell æ¨™é¡Œæ–‡å­—çš„é¡è‰²ã€‚å…ˆå®£å‘Š <strong>var textColor: UIColor?</strong> æˆå“¡è®Šæ•¸ï¼Œç•¶ cell è¢«é¸ ( <strong>isSelected</strong> ) åˆ°æ™‚ <strong>textColor</strong> ç‚ºç´…è‰²ï¼Œè€Œæ²’è¢«é¸åˆ°å‰‡ç‚ºé»‘è‰²ï¼Œè€Œå›å‚³å€¼ä»ç„¶æ˜¯ <strong>return</strong> è‡ªå·± ( self )ï¼Œåªä¸éé€™å€‹è‡ªå·±æœƒæ ¹æ“š cell ä¸åŒçš„ç‹€æ…‹ ( state ) ä¾†æ”¹è®Š <strong>textColor</strong>ã€‚</p>
<p>è€Œåœ¨ <strong>table view cell</strong>ï¼Œå‰‡æ–°å¢é€™å¹¾è¡Œ</p>
<pre><code class="highlight pf">private var a_news = News(image: nil, title: nil, source: nil)

// when cell is selected, this update would be called
override func updateConfiguration(using <span class="keyword">state</span>: UICellConfigurationState) &#123;
	super.updateConfiguration(using: <span class="keyword">state</span>)  
    // generate configuration <span class="keyword">for</span> cell content based <span class="keyword">on</span> cell&#x27;s <span class="keyword">state</span>
    let contentConfig = NewsContentConfiguration_US(news: a_news).updated(<span class="keyword">for</span>: <span class="keyword">state</span>)
    contentConfiguration = contentConfig        
&#125;

func <span class="built_in">set</span>(news: News) &#123;
     contentConfiguration = NewsContentConfiguration_US(news: news)
     a_news = news
&#125;
</code></pre>




<p>æ–°å¢ <code>private var a_news</code> ä¾†å„²å­˜ <strong>set(news:)</strong> æ™‚å‚³å…¥çš„ <strong>news</strong>ã€‚</p>
<p>å¦å¤–æ–°å¢<strong>è¦†å¯«</strong> ( <strong>override</strong> ) **<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uitableviewcell/3601059-updateconfiguration">updateConfiguration(using:)**</a> é€™ functionï¼Œç•¶æ¯æ¬¡ <strong>tableview cell</strong> ç‹€æ…‹ ( <strong>UICellConfigurationState</strong> ) æœ‰æ”¹è®Šæ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•å‘¼å«æ­¤ functionï¼Œå› æ­¤å¯ä»¥åœ¨ update è£¡æ”¹è®Šæˆ‘å€‘è¨­è¨ˆçš„ <strong>content configuration</strong>( ä¾‹å¦‚ <strong>NewsContentConfiguration_US</strong> ) ï¼Œä¸¦æŠŠ <strong>cell ç‹€æ…‹</strong>å‚³å…¥ã€‚ç•¶å›å‚³æ™‚å°±å¯ä»¥ç›´æ¥å†æ¬¡è¨­å®šåˆ° cell çš„ <strong>contentConfiguration</strong>ï¼Œå› ç‚º <strong>configuration</strong> æ˜¯ <strong>struct</strong>ï¼Œæ‰€ä»¥ iOS ä¸æ€•æˆ‘å€‘ä¸€ç›´ç”¢ç”Ÿä¸€ç›´è¨­å®šã€‚</p>
<p>æœ€å¾Œ <strong>Content View</strong> éœ€ä¿®æ”¹å¦‚ä¸‹ï¼Œç”¨ä»¥æ”¹è®Šæ–‡å­—é¡è‰²</p>
<pre><code class="highlight swift"><span class="keyword">var</span> configuration: <span class="keyword">any</span> <span class="type">UIContentConfiguration</span> &#123;
    <span class="keyword">didSet</span> &#123;
        setStyle()
    &#125;    
&#125;

<span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">setStyle</span>() &#123;
	<span class="keyword">guard</span> <span class="keyword">let</span> config <span class="operator">=</span> configuration <span class="keyword">as?</span> <span class="type">NewsContentConfiguration_US</span> <span class="keyword">else</span> &#123;
		<span class="keyword">return</span>
    &#125;
    
    newsTitleLabel.textColor <span class="operator">=</span> config.textColor
    newsSourceLabel.textColor <span class="operator">=</span> config.textColor    
&#125;</code></pre>



<p>åœ¨åŸæœ¬çš„ <strong>configuration</strong> è£¡æ–°å¢ <strong>didSet</strong> çš„å‘¼å«ï¼Œç•¶å‚³å…¥çš„ <strong>configuration</strong> ä¸€æœ‰è®Šå‹•ä¹‹å¾Œï¼Œå°±æœƒå»å‘¼å« <strong>didSet</strong> è£¡çš„ <strong>setStyle</strong> ï¼Œç”¨ä¾†è¨­å®š <strong>UILabel</strong> çš„ <strong>textColor</strong>ã€‚</p>
<p>è¡Œæ–‡åˆ°é€™ï¼Œä¸çŸ¥é“æœ‰æ²’æœ‰äººæœ‰ç–‘å•ï¼Ÿç”¨å‚³çµ±å¯« code çš„æ–¹å¼ä¾†ç”¢ç”Ÿ <strong>table view cell</strong> å°±å·²ç¶“å¤ å›‰å”†äº†ï¼Œç‚ºä½•åœ¨ <strong>iOS 14</strong> è˜‹æœè¦å¼•é€²é€™çœ‹ä¼¼å›‰å”†è¤‡é›œçš„ <strong>Modern Cell Configuration</strong> ï¼Œæ—¢è¦æ–°å¢ <strong>content configuration</strong> åˆè¦æ–°å¢ <strong>content view</strong>ï¼Ÿç­”æ¡ˆæ­æ›‰ï¼šåŸä¾†é€™ä¸€åˆ‡éƒ½æ˜¯ç‚ºäº† <strong>SwiftUI</strong> åœ¨é‹ªè·¯å•Šï¼<strong>table view cell</strong> æœ‰äº† <strong>content configuration</strong> çš„è¨­è¨ˆï¼Œå°±å¯ä»¥é€é **<a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/SwiftUI/UIHostingConfiguration">UIHostingConfiguration(content:)</a>**çš„å¼•è–¦ï¼Œç›´æ¥å¼•å…¥ <strong>SwiftUI</strong> æ‰€æ’°å¯«çš„ viewï¼Œè˜‹æœæ•™ä¸»çš„é€™ä¸€é»å°å¿ƒæ€ï¼Œè±ˆä¸å¦™å“‰ğŸ˜</p>
<h4 id="åƒè€ƒå®Œæ•´ç¨‹å¼å°ˆæ¡ˆ-https-github-com-theLittleApps-ModernCellConfigurationExample"><a href="#åƒè€ƒå®Œæ•´ç¨‹å¼å°ˆæ¡ˆ-https-github-com-theLittleApps-ModernCellConfigurationExample" class="headerlink" title="åƒè€ƒå®Œæ•´ç¨‹å¼å°ˆæ¡ˆ https://github.com/theLittleApps/ModernCellConfigurationExample"></a>åƒè€ƒå®Œæ•´ç¨‹å¼å°ˆæ¡ˆ <a target="_blank" rel="noopener" href="https://github.com/theLittleApps/ModernCellConfigurationExample">https://github.com/theLittleApps/ModernCellConfigurationExample</a></h4><h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=8xjkFkSpl1M">Modern Cell Configuration in iOS 14 (Swift 5, Xcode 12, 2020) - iOS Development</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://apppeterpan.medium.com/%E5%BE%9E-ios-15-%E9%96%8B%E5%A7%8B-%E4%BD%BF%E7%94%A8%E5%85%A7%E5%BB%BA-cell-%E6%A8%A3%E5%BC%8F%E5%BB%BA%E8%AD%B0%E6%90%AD%E9%85%8D-uilistcontentconfiguration-13d64eb317be">å¾ iOS 15 é–‹å§‹ï¼Œä½¿ç”¨å…§å»º cell æ¨£å¼å»ºè­°æ­é… UIListContentConfiguration</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://medium.com/swlh/ios-14-modern-cell-configuration-for-beginners-programmatically-2a1be3f12a90">iOS 14 â€” Modern Cell Configuration for Beginners (Programmatically)</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://www.biteinteractive.com/cell-content-configuration-in-ios-14/?utm_source=pocket_shared">The Developerâ€™s Guide to Cell Content Configuration in iOS 14</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/63075418/how-to-use-ios-14-cell-content-configurations-in-general?utm_source=pocket_shared">how to use iOS 14 cell content configurations in general?</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://swiftbysundell.com/articles/rendering-swiftui-views-within-uitableview-or-uicollectionview/?utm_source=pocket_shared">Rendering SwiftUI views within UITableView or UICollectionView cells on iOS 16</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://medium.com/@dragos.rotaru9/uitableviewcell-in-ios-14-ef19e877319f">UITableViewCell in iOS 14</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/64847456/how-to-implement-a-text-field-cell-with-custom-content-configuration-in-ios-14?utm_source=pocket_shared">How to implement a text field cell with custom content configuration in iOS 14?</a><br>&#x3D;&gt; <a target="_blank" rel="noopener" href="https://swiftsenpai.com/development/uicollectionview-list-custom-cell/?utm_source=pocket_shared">UICollectionView List with Custom Cell and Custom Configuration</a></p>
<h3 id="è´ŠåŠ©æˆ‘å€‘"><a href="#è´ŠåŠ©æˆ‘å€‘" class="headerlink" title="è´ŠåŠ©æˆ‘å€‘"></a>è´ŠåŠ©æˆ‘å€‘</h3><p><a href="https://www.buymeacoffee.com/thelittleapps" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-yellow.png" alt="Buy Me A Coffee" height="41" width="174"></a></p>
</main>
</article>
<div>
  <section id="comments" class="comments">
    <style>
      .utterances{max-width: 100%;}
    </style>
    <script src="https://utteranc.es/client.js"
      repo="theLittleApps/theLittleApps.github.io"
      issue-term="url"
      theme="preferred-color-scheme"
      crossorigin="anonymous"
      async>
    </script>
  </section>
</div>

<script src="/js/highlight.js"></script>

  </main>
  <footer class="footer">
  
  <span>Copyright Â© 2024 The Little Apps</span>
  
</footer>
  
<script src="/js/theme.js"></script>

</body>

</html>